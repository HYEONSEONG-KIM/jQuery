<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel = "stylesheet" href = "../css/board.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<script src = "../js/board.js" type="text/javascript"></script>

<script type="text/javascript">
	currentPage = 1;
	$(function(){
		
		readServer(currentPage);
		
		// 글쓰기
		$('#write').on('click', function(){
			// 새로운 창 열기
			$('#wModal').modal('show');
		})
		// 글 입력 후 전송
		$('#send').on('click', function(){
			// 입력한 값 가져오기
			writeServer();
			// 새로운 창 닫기
			$('#wModal').modal('hide');
			$('.text').val("");
		})
		
		/* // 모달창 닫기 이벤트
		$('#wModal').on('hide.bs.modal', function(){
			
		}) */
		
		// 페이지 번호 클릭 이벤트 - 동적으로 생성된 요소
		$('#pageList').on('click','.paging', function(){
			currentPage = $(this).text().trim();
			readServer(currentPage);
		})
		
		// 이전 버튼 클릭 이벤트
		$('#pageList').on('click','.prev', function(){
			vprev = $('.pagination .paging').first().text().trim();
			currentPage = parseInt(vprev) - 1;
			readServer(currentPage);
		})
		
		// 다음 버튼 클릭 이벤트
		$('#pageList').on('click','.next', function(){
			vnext = $('.pagination .paging').last().text().trim();
			currentPage = parseInt(vnext) + 1;

			readServer(currentPage);
		})
		
		// 버튼 이벤트 - 수정,삭제,등록 , 댓글삭제, 댓글 수정-> 동적으로 생성된 요소
		$('#list').on('click', '.action', function(){
			// 해당 버튼 이름
			vname = $(this).attr('name');
			
			// 글번호
			vidx = $(this).attr('idx');
			
			
			if(vname == "reply"){
				// 내용 입력, 이름
				vname1 = String.fromCharCode(Math.random() * 26 + 65);
				vname2 = String.fromCharCode(Math.random() * 26 + 97);
				vname3 = parseInt(Math.random() * 100 + 1);
				
				// 입력한 내용
				vcont = $(this).prev().val();
				$(this).prev().val("");
				// 객체선언 - 동적으로 메서드나 필드추가 가능
				reply = {};
				
				// 객체에 필드 추가
				reply.bonum = vidx;
				reply.cont = vcont;
				reply.name = vname1 + vname2 +vname3;
				
				// 서버로 전송 - ajax() - js
				replyServer(this);
			
				
				
			}else if(vname == "delete"){
				
			}else if(vname == "modify"){
				
			}else if(vname == "r_modify"){
				// 이미 댓글 수정창이 열려있는지 비교
				// 열려 있다면 replyReset 호출
				if($('#modifyForm').css('display') != "none"){
					replyReset();
				}
				// 댓글 수정 - p태그에 수정할 내용 가져오기
				modifycont = $(this).parents('.rep').find('.cont').html()
				
				//textarea에 출력 => <br> -> \n 으로 수정
				modifycont = modifycont.replace(/<br>/g, "\n");
				$('#modifyForm textarea').val(modifycont);
				
				// 댓글 수정 폼 보이리
				$(this).parents('.rep').find('.cont').empty().append($('#modifyForm'));
				$('#modifyForm').show();
				
				
			}else if(vname == "r_delete"){
				// 댓글 삭제
				replyDelete();
				$(this).parents('.rep').remove();
				
				
			}
		})
		//-------------------------------
		// 댓글 수정이 열려있는 상태에서 다른 곳의 댓글 수정을 누르면
		// 현재 댓글 수정창이 사라지면서 내용이 없어짐 해결 함수
		// 수정 창은 사라지지만 내용은 원래대로 남아 있음
		replyReset = function(){
			
			contp3 = $('#modifyForm').parent();
			// modifyForm을 다시 body로 append
			$('#modifyForm').appendTo('body');
			$('#modifyForm').hide();
			
			// 원래 내용을 contp3에 다시 출력
			modifycont = modifycont.replace(/\n/g, "<br>");
			$(contp3).html(modifycont)
		}
		//-------------------------------
		
		
		 //리스트의 제목을 클릭하면 - 내용과 같이 댓글내용도 출력
		$('#list').on('click', '.list',function(){
			vidx = $(this).attr('idx');
			replyListServer(this);
			
		}) 
		
		// 댓글 수정 화면에서 취소 버튼을 누르면
		$('#cancel').on('click', function(){
			replyReset();
		})
		
		// 댓글 수정 화면에서 확인 버튼을 누르면
		$('#ok').on('click',function(){
			// 수정 내용 가져오기
			modifyCont = $('#modifyForm textarea').val()
			
			// cont p3 검색
			contp3 = $('#modifyForm').parent()
			
			// 댓글 수정창 닫기 - body로 다시 이동 - 감추기
			$('body').append($('#modifyForm'));
			$('#modifyForm').hide();
			
			// contp3에 수정내용 출력 => <br>로 수정
			modi = modifyCont.replace(/\r/g, "").replace(/\n/g, "<br>")
			$(contp3).html(modi);
			
			reply = {}
			
			reply.renum = vidx;
			reply.cont = modifyCont;
			// 서버로 전송
			replyUpdate();
			
		})
		
		
	})
</script>
</head>
<body>

<div id = "modifyForm">
	<textarea rows="5" cols="50"></textarea>
	<input type = "button" id = "ok" value = "확인">
	<input type = "button" id = "cancel" value = "취소">
</div>

<div class = "box" id = "box1">
		<h3>Accordion 게시글</h3>
		
		<div id = "dwr">
			<input type = "button" value = "글쓰기" id = "write">
		</div>
		
		<div id = "list"></div>
		<br>
		<div id = "pageList"></div>
	</div>
	
	<!-- Modal -->
	<div id="wModal" class="modal fade" role="dialog">
	  <div class="modal-dialog">
	
	    <!-- Modal content-->
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal">&times;</button>
	        <h4 class="modal-title">Modal Header</h4>
	      </div>
	      <div class="modal-body">
		      <form>
		      	<label>이름</label>
		       	<input type = "text" class = "text" name = "writer"><br>
		       	
		       	<label>제목</label>
		       	<input type = "text" class = "text" name = "subject"><br>
		       	
		       	<label>메일</label>
		       	<input type = "text" class = "text" name = "mail"><br>
		       	
		       	<label>비밀번호</label>
	       		<input type = "text" class = "text" name = "password"><br>
		       	
		       	<label>내용</label><br>
		       	<textarea rows = "10" cols = "70" class = "text" name = "content"></textarea><br>
		       	<br>
		       	<input type = "button" class = "btn btn-success" value = "전송" id = "send">
		      </form>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
	      </div>
	    </div>
	
	  </div>
	</div>
</body>
</html>